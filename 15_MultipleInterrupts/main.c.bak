#include "stm32f4xx.h"

/*Tested with ARM Compiler : version 5*/



void delayMs(int n);

volatile int pb10_counter;
volatile int pc13_counter;

int main(void) {
    __disable_irq();                    

    RCC->AHB1ENR |= 1;                  
    RCC->AHB1ENR |= 4;	                
    RCC->AHB1ENR |= 2;                  
    RCC->APB2ENR |= 0x4000;             

    GPIOA->MODER |=  0x400;       

    
    SYSCFG->EXTICR[3] |= 0x0020;          
    EXTI->IMR |= 0x2000;                // unmask EXTI13 
    EXTI->FTSR |= 0x2000;               // select falling edge trigger 

    GPIOB->PUPDR |=  0x00100000;        // Enable pull up resistor 
    
    SYSCFG->EXTICR[2] |= 0x0100;        // Select port B for EXTI10 
    
    EXTI->IMR |= 0x0400;                // Unmask EXTI10 
    EXTI->FTSR |= 0x0400;               // Select falling edge trigger

    NVIC_EnableIRQ(EXTI15_10_IRQn);     
    __enable_irq();                    
    
    while(1) {
    }
}

void EXTI15_10_IRQHandler(void) {
    if (EXTI->PR == 0x2000) {      


        EXTI->PR = 0x2000;          //clear interrupt pending flag */
    }
    else if (EXTI->PR == 0x0400) {  /* interrupt from PB10 */

        EXTI->PR = 0x0400;          /* clear interrupt pending flag */
    }
}

/* 16 MHz SYSCLK */
void delayMs(int n) {
    int i;
    for (; n > 0; n--)
        for (i = 0; i < 3195; i++) ;
}
